# VDO.Ninja SDK — API Reference

This page lists the primary methods, helpers, aliases, and events exposed by the SDK. It complements the short examples in README.

Tip: For custom app protocols, avoid using reserved types 'subscribe' | 'unsubscribe' | 'channelMessage' on the pipe payload — those are used by the SDK pub/sub system.

## Constructor

```js
const vdo = new VDONinjaSDK(options)
```

- host: WebSocket URL (default: `wss://wss.vdo.ninja`)
- room: Initial room to join (optional)
- password: Room password or false to disable encryption (default: autogenerated key)
- label: Optional human-readable label for your stream/view
- debug: Enable SDK logs (boolean)
- turnServers: null=auto-fetch, false=disable, or custom ICE servers
- forceTURN: Force relay mode (boolean)
- stunServers, configuration, salt, plus advanced info flags (see README for details)

## Connection

- connect(): Promise<void>
- disconnect(): void
- joinRoom({ room, password }): Promise<void>
- leaveRoom(): void
- autoConnect(roomOrOptions, filter?): Promise<{ stop: Function, streamID: string }>
  - Shorthand to connect, join, announce, and view peers in a mesh.
  - Options: { room, mode: 'half' | 'full', view: { audio, video }, label, password, streamID?, filter }

## Publishing (Sender)

- publish(stream, { streamID, room?, label?, password?, media? }): Promise<string>
  - media: { video?: { codec?, maxBitrate?, resolution?, frameRate? }, audio?: { codec?, maxBitrate? } }
- announce({ streamID?, room?, label?, password? }): Promise<string>
  - Data-only publishing; generates a streamID if not provided.
- stopPublishing(): void
- updatePublisherMedia({ media?, videoBitrate?, videoCodec?, clear? }): Promise<Object|null>
  - Re-applies bitrate/codec/resolution preferences to the active publisher; use `clear:true` to reset.

## Viewing (Receiver)

- view(streamID, { audio=true, video=true, label? }): Promise<RTCPeerConnection>
- stopViewing(streamID): void

## Quick Helpers

- quickPublish({ stream, room?, streamID?, label?, password? }): Promise<string>
- quickView({ streamID, room?, audio?, video?, label?, password?, dataOnly? }): Promise<RTCPeerConnection>
  - dataOnly: true maps to { audio:false, video:false }
- quickSubscribe({ streamID, room?, ... } = {}): Promise<RTCPeerConnection>
  - Convenience wrapper around quickView that defaults to dataOnly unless explicitly overridden.

## Data Communication

- sendData(data, target?): boolean
  - target: undefined → all; 'uuid' → specific; { uuid?, type?: 'viewer'|'publisher', streamID?, preference?: 'any'|'viewer'|'publisher'|'all', allowFallback? }
- sendPing(uuid?): boolean
- request(requestType, data, targetUUID, timeout=5000): Promise<any>
- respond(requestId, data, targetUUID): boolean
- onRequest(requestType, handler): void

## Pub/Sub

- subscribe(channels: string | string[]): void
- unsubscribe(channels: string | string[]): void
- getSubscriptions(): string[]
- publishToChannel(channel: string, data: any, target = 'all'): boolean
- getPeerSubscriptions(uuid: string): string[]

Events:
- channelMessage: { channel, data, timestamp, uuid } — only emitted if locally subscribed
- peerSubscribed: { uuid, channels, allChannels }
- peerUnsubscribed: { uuid, channels, allChannels }

## Utilities

- getStats(uuid?): Promise<RTCStatsReport | any>
- on/off/once(eventName, handler): chaining shorthands for add/removeEventListener

## Aliases (Common Names)

- Viewing: play(), watch(), startViewing() → view()
- Publishing: stream(), broadcast(), startPublishing(), share() → publish()
- Quick: quickStream(), quickBroadcast(), quickShare() → quickPublish()
- Stop viewing: stop(), stopPlaying(), stopWatching() → stopViewing()
- Stop publishing: stopStreaming(), stopBroadcasting(), stopSharing(), unpublish() → stopPublishing()
- Connection: join(), enterRoom(), enter() → joinRoom(); leave(), exitRoom() → leaveRoom()

Note: The viewing alias `unsubscribe(streamID)` that conflicted with pub/sub has been removed.

## Events (Selected)

Connection & Room
- connected, disconnected
- reconnecting, reconnected, reconnectFailed
- roomJoined { room }, roomLeft { room }
- listing { list, raw }, peerListing (raw VDO.Ninja listings)

Peer & Channel
- peerConnected { uuid, connection }
- peerDisconnected { uuid }
- dataChannelOpen { uuid, type, streamID }, dataChannelClose { uuid, type, streamID }
- peerInfo { uuid, streamID, info }
- peerLatency { uuid, latency, streamID }

Data
- dataReceived { data, uuid, streamID?, fallback? }
- data (legacy, original WS/DC format)
- Typo alias also emitted: dataRecieved

Media
- track { track, streams?, uuid, streamID }
- trackAdded, trackRemoved, trackReplaced

State & Errors
- publishing { streamID, hashedStreamID }
- publishingStopped
- viewingStopped { streamID }
- connectionFailed { reason, ... }
- iceRestart { uuid, streamID, reason }
- approved, rejected, bye, hangup, transferred, alert { message }, error { error, details? }

## Compatibility Notes

- Reserved pipe types: 'subscribe' | 'unsubscribe' | 'channelMessage' are used by the SDK pub/sub system and do not emit dataReceived; use the pub/sub helpers and events.
- Viewer preferences (audio/video) are sent viewer → publisher via the viewer data channel, not the reverse.
- Legacy support: quickView and autoConnect can infer data-only; you can also pass { dataOnly:true }.
- WebSocket fallback: sendData can deliver via signaling when allowFallback is true; dataReceived includes { fallback:true }.

---

See README for end-to-end examples and the demos folder for runnable samples.
